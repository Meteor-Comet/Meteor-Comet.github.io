---
layout: post
title:  "C# WPF"
date:   2026-01-27 10:00:00 +0800
categories: C# WPF Windows
---

# C# WPF

## å‰è¨€

Windows Presentation Foundation (WPF) æ˜¯å¾®è½¯æ¨å‡ºçš„åŸºäº .NET Framework çš„ç”¨æˆ·ç•Œé¢æ¡†æ¶ï¼Œç”¨äºåˆ›å»º Windows æ¡Œé¢åº”ç”¨ç¨‹åºã€‚WPF æä¾›äº†ä¸°å¯Œçš„å›¾å½¢ã€åŠ¨ç”»å’Œäº¤äº’åŠŸèƒ½ï¼Œæ”¯æŒæ•°æ®ç»‘å®šã€æ ·å¼ã€æ¨¡æ¿ç­‰ç°ä»£ UI å¼€å‘ç‰¹æ€§ï¼Œæ˜¯æ„å»ºç°ä»£åŒ– Windows åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ã€‚

![WPF åº”ç”¨ç¨‹åºç¤ºä¾‹](/img/in-post/wpf-tutorial-image.svg)

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£… Visual Studio

#### 1.1.1 Visual Studio ç‰ˆæœ¬é€‰æ‹©

Visual Studio æ˜¯å¼€å‘ WPF åº”ç”¨ç¨‹åºçš„ä¸»è¦ IDEã€‚æ¨èä½¿ç”¨ä»¥ä¸‹ç‰ˆæœ¬ï¼š

- **Visual Studio 2022 Community**ï¼ˆå…è´¹ï¼‰ï¼šé€‚åˆä¸ªäººå¼€å‘è€…å’Œå°å›¢é˜Ÿ
- **Visual Studio 2022 Professional**ï¼šé€‚åˆä¸“ä¸šå¼€å‘è€…ï¼ŒåŒ…å«æ›´å¤šé«˜çº§åŠŸèƒ½
- **Visual Studio 2022 Enterprise**ï¼šé€‚åˆå¤§å‹å›¢é˜Ÿå’Œä¼ä¸šå¼€å‘

#### 1.1.2 å®‰è£…æ­¥éª¤è¯¦è§£

1. **ä¸‹è½½ Visual Studio**
   - è®¿é—® [Visual Studio å®˜ç½‘](https://visualstudio.microsoft.com/)
   - ä¸‹è½½ Visual Studio 2022 å®‰è£…ç¨‹åº

2. **é€‰æ‹©å·¥ä½œè´Ÿè½½**
   åœ¨å®‰è£…ç¨‹åºçš„å·¥ä½œè´Ÿè½½é€‰é¡¹å¡ä¸­ï¼Œå¿…é¡»é€‰æ‹©ä»¥ä¸‹å·¥ä½œè´Ÿè½½ï¼š
   - âœ… **.NET æ¡Œé¢å¼€å‘**ï¼šåŒ…å« WPFã€WinForm ç­‰æ¡Œé¢åº”ç”¨å¼€å‘å·¥å…·
   - âœ… **.NET è·¨å¹³å°å¼€å‘**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœéœ€è¦è·¨å¹³å°æ”¯æŒ
   - âœ… **.NET Framework 4.8 å¼€å‘å·¥å…·**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœéœ€è¦å¼€å‘ .NET Framework åº”ç”¨

3. **å®‰è£…å¯é€‰ç»„ä»¶**
   - .NET Framework 4.8 SDK
   - .NET 6.0 / 7.0 / 8.0 SDKï¼ˆæ ¹æ®éœ€è¦é€‰æ‹©ï¼‰
   - Windows 10/11 SDKï¼ˆå¦‚æœå¼€å‘ UWP åº”ç”¨ï¼‰

#### 1.1.3 éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

```csharp
// åˆ›å»ºç®€å•çš„ WPF é¡¹ç›®æµ‹è¯•
// 1. æ‰“å¼€ Visual Studio
// 2. åˆ›å»ºæ–°é¡¹ç›®
// 3. é€‰æ‹© "WPF åº”ç”¨"
// 4. è¿è¡Œé¡¹ç›®ï¼Œå¦‚æœèƒ½æ­£å¸¸æ˜¾ç¤ºçª—å£ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ
```

### 1.2 é¡¹ç›®ç±»å‹é€‰æ‹©

#### 1.2.1 .NET Framework vs .NET

WPF åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸¤ç§ .NET å¹³å°ä¸Šå¼€å‘ï¼š

**1. .NET Frameworkï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰**
- é¡¹ç›®ç±»å‹ï¼šWPF åº”ç”¨ (.NET Framework)
- æ”¯æŒç‰ˆæœ¬ï¼š.NET Framework 4.5 åŠä»¥ä¸Šï¼ˆæ¨è 4.7.2 æˆ–æ›´é«˜ï¼‰
- ä¼˜ç‚¹ï¼š
  - æˆç†Ÿç¨³å®šï¼Œæ–‡æ¡£ä¸°å¯Œ
  - ç¬¬ä¸‰æ–¹æ§ä»¶åº“æ”¯æŒå®Œå–„
  - å…¼å®¹æ€§æœ€å¥½
- ç¼ºç‚¹ï¼š
  - åªèƒ½è¿è¡Œåœ¨ Windows å¹³å°
  - ä¸å†ç§¯æå¼€å‘æ–°åŠŸèƒ½
  - é¡¹ç›®ä½“ç§¯è¾ƒå¤§

**2. .NETï¼ˆç°ä»£æ–¹å¼ï¼‰**
- é¡¹ç›®ç±»å‹ï¼šWPF åº”ç”¨
- æ”¯æŒç‰ˆæœ¬ï¼š.NET 6.0ã€.NET 7.0ã€.NET 8.0 ç­‰
- ä¼˜ç‚¹ï¼š
  - è·¨å¹³å°æ”¯æŒï¼ˆ.NET 6+ï¼‰
  - æ€§èƒ½æ›´å¥½
  - æŒç»­æ›´æ–°å’Œç»´æŠ¤
  - é¡¹ç›®ä½“ç§¯æ›´å°
  - æ”¯æŒæœ€æ–°çš„ C# è¯­è¨€ç‰¹æ€§
- ç¼ºç‚¹ï¼š
  - éƒ¨åˆ†ç¬¬ä¸‰æ–¹æ§ä»¶å¯èƒ½ä¸æ”¯æŒ
  - è¿ç§»å¯èƒ½éœ€è¦è°ƒæ•´ä»£ç 

**é€‰æ‹©å»ºè®®ï¼š**
- æ–°é¡¹ç›®ï¼šæ¨èä½¿ç”¨ .NET 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- å·²æœ‰é¡¹ç›®ï¼šå¯ä»¥ç»§ç»­ä½¿ç”¨ .NET Frameworkï¼Œæˆ–é€æ­¥è¿ç§»åˆ° .NET

#### 1.2.2 åˆ›å»º WPF é¡¹ç›®è¯¦ç»†æ­¥éª¤

**æ–¹å¼ä¸€ï¼šé€šè¿‡ Visual Studio åˆ›å»º**

```
1. æ‰“å¼€ Visual Studio 2022
2. ç‚¹å‡» "åˆ›å»ºæ–°é¡¹ç›®" æˆ–ä½¿ç”¨å¿«æ·é”® Ctrl+Shift+N
3. åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ "WPF"
4. é€‰æ‹©åˆé€‚çš„é¡¹ç›®æ¨¡æ¿ï¼š
   - WPF åº”ç”¨ï¼šé€‚ç”¨äº .NET 6.0+
   - WPF åº”ç”¨ (.NET Framework)ï¼šé€‚ç”¨äº .NET Framework
5. ç‚¹å‡» "ä¸‹ä¸€æ­¥"
6. é…ç½®é¡¹ç›®ï¼š
   - é¡¹ç›®åç§°ï¼šè¾“å…¥æœ‰æ„ä¹‰çš„åç§°ï¼ˆå¦‚ "MyWpfApp"ï¼‰
   - ä½ç½®ï¼šé€‰æ‹©é¡¹ç›®ä¿å­˜çš„æ–‡ä»¶å¤¹
   - è§£å†³æ–¹æ¡ˆåç§°ï¼šé€šå¸¸ä¸é¡¹ç›®åç§°ç›¸åŒ
   - æ¡†æ¶ï¼šé€‰æ‹© .NET ç‰ˆæœ¬ï¼ˆå¦‚ .NET 6.0ã€.NET 8.0 æˆ– .NET Framework 4.8ï¼‰
7. ç‚¹å‡» "åˆ›å»º"
```

**æ–¹å¼äºŒï¼šé€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºï¼ˆ.NET CLIï¼‰**

```bash
# åˆ›å»º .NET 6.0+ çš„ WPF é¡¹ç›®
dotnet new wpf -n MyWpfApp -f net8.0

# è¿›å…¥é¡¹ç›®ç›®å½•
cd MyWpfApp

# ä½¿ç”¨ Visual Studio æ‰“å¼€
dotnet sln add MyWpfApp.csproj
start MyWpfApp.sln
```

#### 1.2.3 é¡¹ç›®ç»“æ„è¯´æ˜

åˆ›å»ºé¡¹ç›®åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
MyWpfApp/
â”œâ”€â”€ MyWpfApp.csproj      # é¡¹ç›®æ–‡ä»¶ï¼ˆåŒ…å«é¡¹ç›®é…ç½®å’Œä¾èµ–ï¼‰
â”œâ”€â”€ Program.cs            # ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ App.xaml              # åº”ç”¨ç¨‹åºå®šä¹‰æ–‡ä»¶
â”œâ”€â”€ App.xaml.cs           # åº”ç”¨ç¨‹åºä»£ç æ–‡ä»¶
â”œâ”€â”€ MainWindow.xaml       # ä¸»çª—å£çš„ XAML æ–‡ä»¶
â”œâ”€â”€ MainWindow.xaml.cs    # ä¸»çª—å£çš„ä»£ç æ–‡ä»¶
â””â”€â”€ Properties/           # é¡¹ç›®å±æ€§æ–‡ä»¶å¤¹
    â”œâ”€â”€ Resources.resx    # èµ„æºæ–‡ä»¶
    â”œâ”€â”€ Settings.settings # è®¾ç½®æ–‡ä»¶
    â””â”€â”€ AssemblyInfo.cs   # ç¨‹åºé›†ä¿¡æ¯
```

### 1.3 å¼€å‘ç¯å¢ƒé…ç½®

#### 1.3.1 NuGet åŒ…ç®¡ç†å™¨é…ç½®

NuGet æ˜¯ .NET çš„åŒ…ç®¡ç†å™¨ï¼Œç”¨äºå®‰è£…ç¬¬ä¸‰æ–¹åº“ï¼š

```bash
# åœ¨ Visual Studio ä¸­æ‰“å¼€ NuGet åŒ…ç®¡ç†å™¨
# å·¥å…· -> NuGet åŒ…ç®¡ç†å™¨ -> ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°

# æˆ–è€…é€šè¿‡ç•Œé¢ï¼šå³é”®é¡¹ç›® -> ç®¡ç† NuGet ç¨‹åºåŒ…
```

å¸¸ç”¨ NuGet æºï¼š
- nuget.orgï¼ˆé»˜è®¤ï¼‰
- ä¸­å›½é•œåƒæºï¼ˆæ¨èå›½å†…å¼€å‘è€…ä½¿ç”¨ï¼Œæå‡ä¸‹è½½é€Ÿåº¦ï¼‰

#### 1.3.2 ä»£ç ç¼–è¾‘å™¨è®¾ç½®

æ¨èé…ç½®ï¼š

1. **å­—ä½“è®¾ç½®**
   - å·¥å…· -> é€‰é¡¹ -> ç¯å¢ƒ -> å­—ä½“å’Œé¢œè‰²
   - æ¨èå­—ä½“ï¼šConsolasã€Fira Codeã€Cascadia Code

2. **ä»£ç æ ¼å¼åŒ–**
   - å·¥å…· -> é€‰é¡¹ -> æ–‡æœ¬ç¼–è¾‘å™¨ -> C# -> ä»£ç æ ·å¼ -> æ ¼å¼è®¾ç½®

3. **æ™ºèƒ½æç¤º**
   - å·¥å…· -> é€‰é¡¹ -> æ–‡æœ¬ç¼–è¾‘å™¨ -> C# -> IntelliSense
   - å¯ç”¨å®æ—¶ IntelliSense

4. **XAML ç¼–è¾‘å™¨è®¾ç½®**
   - å·¥å…· -> é€‰é¡¹ -> æ–‡æœ¬ç¼–è¾‘å™¨ -> XAML -> æ ¼å¼è®¾ç½®
   - å¯ç”¨è‡ªåŠ¨æ ¼å¼åŒ–

#### 1.3.3 è°ƒè¯•é…ç½®

1. **å¯åŠ¨é…ç½®**
   - é¡¹ç›®å±æ€§ -> è°ƒè¯•
   - é…ç½®å¯åŠ¨æ“ä½œå’Œå¯åŠ¨é¡¹ç›®

2. **å¼‚å¸¸è®¾ç½®**
   - è°ƒè¯• -> Windows -> å¼‚å¸¸è®¾ç½®
   - é…ç½®éœ€è¦ä¸­æ–­çš„å¼‚å¸¸ç±»å‹

### 1.4 ç¬¬ä¸€ä¸ª WPF ç¨‹åº

åˆ›å»ºé¡¹ç›®åï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªç®€å•çš„ WPF åº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬è¿è¡Œå¹¶æŸ¥çœ‹ä»£ç ï¼š

```csharp
// Program.cs - ç¨‹åºå…¥å£ç‚¹
using System;
using System.Windows;

namespace MyWpfApp
{
    internal static class Program
    {
        /// <summary>
        /// åº”ç”¨ç¨‹åºçš„ä¸»å…¥å£ç‚¹ã€‚
        /// </summary>
        [STAThread]
        static void Main()
        {
            var app = new App();
            app.Run();
        }
    }
}
```

```xaml
<!-- App.xaml - åº”ç”¨ç¨‹åºå®šä¹‰ -->
<Application x:Class="MyWpfApp.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MyWpfApp"
             StartupUri="MainWindow.xaml">
    <Application.Resources>
    </Application.Resources>
</Application>
```

```xaml
<!-- MainWindow.xaml - ä¸»çª—å£å®šä¹‰ -->
<Window x:Class="MyWpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MyWpfApp"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">
    <Grid>
        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="24">
            Hello, WPF!
        </TextBlock>
    </Grid>
</Window>
```

è¿è¡Œç¨‹åºï¼ˆF5ï¼‰ï¼Œå³å¯çœ‹åˆ°ä¸€ä¸ªæ˜¾ç¤º "Hello, WPF!" çš„çª—å£ã€‚

![Visual Studio ç¯å¢ƒå‡†å¤‡](/img/in-post/wpf-env-setup.svg)

## 2. WPF XAML åŸºç¡€

### 2.1 XAML ç®€ä»‹

XAMLï¼ˆExtensible Application Markup Languageï¼‰æ˜¯ä¸€ç§å£°æ˜å¼æ ‡è®°è¯­è¨€ï¼Œç”¨äºå®šä¹‰ WPF åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ã€‚XAML åŸºäº XMLï¼Œæä¾›äº†ä¸€ç§ç®€æ´ã€ç›´è§‚çš„æ–¹å¼æ¥åˆ›å»ºå’Œå¸ƒå±€ UI å…ƒç´ ã€‚

#### 2.1.1 XAML çš„åŸºæœ¬è¯­æ³•

```xaml
<!-- åŸºæœ¬ XAML ç»“æ„ -->
<Window x:Class="MyWpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="450" Width="800">
    <!-- å†…å®¹åŒºåŸŸ -->
    <Grid>
        <Button Content="Click Me" Width="100" Height="30" />
    </Grid>
</Window>
```

#### 2.1.2 XAML å‘½åç©ºé—´

XAML æ–‡ä»¶ä¸­çš„å‘½åç©ºé—´å®šä¹‰äº†å¯ç”¨çš„å…ƒç´ å’Œç±»å‹ï¼š

- `xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"`ï¼šWPF æ ¸å¿ƒå‘½åç©ºé—´ï¼ŒåŒ…å«æ‰€æœ‰ UI å…ƒç´ 
- `xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"`ï¼šXAML è¯­è¨€å‘½åç©ºé—´ï¼ŒåŒ…å« XAML ç‰¹å®šçš„åŠŸèƒ½
- `xmlns:local="clr-namespace:MyWpfApp"`ï¼šæœ¬åœ°å‘½åç©ºé—´ï¼Œå¼•ç”¨å½“å‰é¡¹ç›®ä¸­çš„ç±»å‹

#### 2.1.3 XAML å…ƒç´ ä¸å±æ€§

XAML ä¸­çš„æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ª .NET ç±»ï¼Œå±æ€§å¯¹åº”ç±»çš„å±æ€§ï¼š

```xaml
<!-- å…ƒç´  = ç±»ï¼Œå±æ€§ = ç±»çš„å±æ€§ -->
<Button Content="Click Me" Width="100" Height="30" />

<!-- ç­‰åŒäº C# ä»£ç  -->
// Button button = new Button();
// button.Content = "Click Me";
// button.Width = 100;
// button.Height = 30;
```

### 2.2 XAML å¸ƒå±€ç³»ç»Ÿ

WPF æä¾›äº†å¤šç§å¸ƒå±€æ§ä»¶ï¼Œç”¨äºç»„ç»‡å’Œæ’åˆ— UI å…ƒç´ ï¼š

#### 2.2.1 å¸¸ç”¨å¸ƒå±€æ§ä»¶

| å¸ƒå±€æ§ä»¶ | æè¿° | é€‚ç”¨åœºæ™¯ |
|---------|------|----------|
| Grid | ç½‘æ ¼å¸ƒå±€ï¼Œæ”¯æŒè¡Œåˆ—åˆ’åˆ† | å¤æ‚å¸ƒå±€ï¼Œéœ€è¦ç²¾ç¡®å®šä½ |
| StackPanel | å †å å¸ƒå±€ï¼Œæ°´å¹³æˆ–å‚ç›´æ’åˆ— | ç®€å•çš„çº¿æ€§æ’åˆ— |
| WrapPanel | è‡ªåŠ¨æ¢è¡Œçš„å †å å¸ƒå±€ | åŠ¨æ€æ•°é‡çš„å…ƒç´ æ’åˆ— |
| DockPanel | åœé å¸ƒå±€ï¼Œå…ƒç´ å¯ä»¥åœé åœ¨è¾¹ç¼˜ | å·¥å…·æ ã€çŠ¶æ€æ ç­‰ |
| Canvas | ç”»å¸ƒå¸ƒå±€ï¼Œä½¿ç”¨ç»å¯¹åæ ‡å®šä½ | è‡ªå®šä¹‰ç»˜å›¾ã€æ¸¸æˆç•Œé¢ |
| UniformGrid | å‡åŒ€ç½‘æ ¼å¸ƒå±€ï¼Œæ‰€æœ‰å•å…ƒæ ¼å¤§å°ç›¸åŒ | å›¾æ ‡ç½‘æ ¼ã€æ£‹ç›˜ç­‰ |

#### 2.2.2 å¸ƒå±€ç¤ºä¾‹

**1. Grid å¸ƒå±€**

```xaml
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="2*" />
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition Height="50" />
        <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    
    <TextBlock Grid.Column="0" Grid.Row="0" Text="å·¦ä¾§æ ‡é¢˜" />
    <Button Grid.Column="1" Grid.Row="0" Content="å³ä¾§æŒ‰é’®" />
    <TextBox Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Text="å†…å®¹åŒºåŸŸ" />
</Grid>
```

**2. StackPanel å¸ƒå±€**

```xaml
<StackPanel Orientation="Vertical" Margin="10">
    <Button Content="æŒ‰é’® 1" Margin="5" />
    <Button Content="æŒ‰é’® 2" Margin="5" />
    <Button Content="æŒ‰é’® 3" Margin="5" />
</StackPanel>
```

**3. DockPanel å¸ƒå±€**

```xaml
<DockPanel>
    <Menu DockPanel.Dock="Top">
        <MenuItem Header="æ–‡ä»¶" />
        <MenuItem Header="ç¼–è¾‘" />
    </Menu>
    <ToolBar DockPanel.Dock="Top">
        <Button Content="æ–°å»º" />
        <Button Content="æ‰“å¼€" />
    </ToolBar>
    <StatusBar DockPanel.Dock="Bottom">
        <TextBlock>çŠ¶æ€æ </TextBlock>
    </StatusBar>
    <Grid>
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    </Grid>
</DockPanel>
```

### 2.3 XAML æ•°æ®ç»‘å®š

æ•°æ®ç»‘å®šæ˜¯ WPF çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå…è®¸ UI å…ƒç´ ä¸æ•°æ®æºè‡ªåŠ¨åŒæ­¥ï¼š

#### 2.3.1 æ•°æ®ç»‘å®šåŸºç¡€

```xaml
<!-- åŸºæœ¬æ•°æ®ç»‘å®š -->
<TextBox Text="{Binding Name}" />
<Button Content="{Binding ButtonText}" Command="{Binding ClickCommand}" />
```

#### 2.3.2 ç»‘å®šæ¨¡å¼

| ç»‘å®šæ¨¡å¼ | æè¿° |
|---------|------|
| OneWay | ä»æ•°æ®æºåˆ°ç›®æ ‡ï¼Œå•å‘ç»‘å®š |
| TwoWay | åŒå‘ç»‘å®šï¼Œæ•°æ®æºå’Œç›®æ ‡ç›¸äº’åŒæ­¥ |
| OneWayToSource | ä»ç›®æ ‡åˆ°æ•°æ®æºï¼Œå•å‘ç»‘å®š |
| OneTime | åªç»‘å®šä¸€æ¬¡ï¼Œåç»­å˜åŒ–ä¸å½±å“ |
| Default | æ ¹æ®ç›®æ ‡å±æ€§çš„é»˜è®¤è¡Œä¸º |

#### 2.3.3 ç»‘å®šç¤ºä¾‹

```xaml
<!-- ç»‘å®šæ¨¡å¼ç¤ºä¾‹ -->
<TextBox Text="{Binding Name, Mode=TwoWay}" />
<TextBlock Text="{Binding Count, Mode=OneWay}" />
<Button Content="{Binding ButtonText, Mode=OneTime}" />
```

### 2.4 XAML æ ·å¼ä¸æ¨¡æ¿

WPF æä¾›äº†æ ·å¼ï¼ˆStyleï¼‰å’Œæ¨¡æ¿ï¼ˆTemplateï¼‰æœºåˆ¶ï¼Œç”¨äºè‡ªå®šä¹‰æ§ä»¶çš„å¤–è§‚ï¼š

#### 2.4.1 æ ·å¼å®šä¹‰ä¸ä½¿ç”¨

```xaml
<!-- åœ¨èµ„æºä¸­å®šä¹‰æ ·å¼ -->
<Window.Resources>
    <Style x:Key="ButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Blue" />
        <Setter Property="Foreground" Value="White" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="10,5" />
    </Style>
</Window.Resources>

<!-- ä½¿ç”¨æ ·å¼ -->
<Button Content="Styled Button" Style="{StaticResource ButtonStyle}" />
```

#### 2.4.2 æ§ä»¶æ¨¡æ¿

```xaml
<!-- è‡ªå®šä¹‰æŒ‰é’®æ¨¡æ¿ -->
<ControlTemplate x:Key="CustomButtonTemplate" TargetType="Button">
    <Border Background="{TemplateBinding Background}"
            BorderBrush="{TemplateBinding BorderBrush}"
            BorderThickness="{TemplateBinding BorderThickness}"
            CornerRadius="5">
        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
    </Border>
    <ControlTemplate.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
            <Setter Property="Background" Value="LightBlue" />
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
            <Setter Property="Background" Value="DarkBlue" />
        </Trigger>
    </ControlTemplate.Triggers>
</ControlTemplate>

<!-- ä½¿ç”¨æ¨¡æ¿ -->
<Button Content="Custom Button" Template="{StaticResource CustomButtonTemplate}" />
```

## 3. WPF æ§ä»¶åŸºç¡€

### 3.1 å¸¸ç”¨æ§ä»¶ä»‹ç»

WPF æä¾›äº†ä¸°å¯Œçš„å†…ç½®æ§ä»¶ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ï¼š

#### 3.1.1 åŸºç¡€æ§ä»¶

| æ§ä»¶åç§° | ç”¨é€” | ä¸»è¦å±æ€§ |
|---------|------|----------|
| Button | æŒ‰é’® | Content, Command, IsEnabled |
| TextBox | æ–‡æœ¬è¾“å…¥æ¡† | Text, IsReadOnly, MaxLength |
| Label | æ–‡æœ¬æ ‡ç­¾ | Content, FontSize, Foreground |
| TextBlock | æ–‡æœ¬å— | Text, FontSize, TextWrapping |
| CheckBox | å¤é€‰æ¡† | IsChecked, Content |
| RadioButton | å•é€‰æŒ‰é’® | IsChecked, GroupName, Content |
| ComboBox | ä¸‹æ‹‰é€‰æ‹©æ¡† | ItemsSource, SelectedItem, DisplayMemberPath |
| ListBox | åˆ—è¡¨æ¡† | ItemsSource, SelectedItem, SelectionMode |
| DataGrid | æ•°æ®è¡¨æ ¼ | ItemsSource, AutoGenerateColumns, Columns |
| Slider | æ»‘å— | Value, Minimum, Maximum, Orientation |
| ProgressBar | è¿›åº¦æ¡ | Value, Minimum, Maximum |
| Calendar | æ—¥å† | SelectedDate, DisplayDate |
| DatePicker | æ—¥æœŸé€‰æ‹©å™¨ | SelectedDate, DisplayDate |

#### 3.1.2 æ§ä»¶ç¤ºä¾‹

**1. Button æ§ä»¶**

```xaml
<Button Content="ç‚¹å‡»æˆ‘" Width="100" Height="30"
        Click="Button_Click" />
```

```csharp
private void Button_Click(object sender, RoutedEventArgs e)
{
    MessageBox.Show("æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼");
}
```

**2. TextBox æ§ä»¶**

```xaml
<TextBox Width="200" Height="30"
         Text="é»˜è®¤æ–‡æœ¬"
         TextChanged="TextBox_TextChanged" />
```

```csharp
private void TextBox_TextChanged(object sender, TextChangedEventArgs e)
{
    TextBox textBox = sender as TextBox;
    Console.WriteLine($"æ–‡æœ¬å·²æ›´æ”¹: {textBox?.Text}");
}
```

**3. ListBox æ§ä»¶**

```xaml
<ListBox Width="200" Height="100"
         ItemsSource="{Binding Items}"
         SelectedItem="{Binding SelectedItem}" />
```

```csharp
// åå°ä»£ç 
public ObservableCollection<string> Items { get; set; }
public string SelectedItem { get; set; }

public MainWindow()
{
    InitializeComponent();
    DataContext = this;
    
    Items = new ObservableCollection<string>
    {
        "é€‰é¡¹ 1",
        "é€‰é¡¹ 2",
        "é€‰é¡¹ 3"
    };
}
```

### 3.2 å¸ƒå±€æ§ä»¶è¯¦ç»†ä½¿ç”¨

#### 3.2.1 Grid å¸ƒå±€è¯¦è§£

Grid æ˜¯æœ€å¸¸ç”¨çš„å¸ƒå±€æ§ä»¶ï¼Œæ”¯æŒå¤æ‚çš„è¡Œåˆ—åˆ’åˆ†ï¼š

```xaml
<Grid>
    <!-- å®šä¹‰åˆ— -->
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="2*" />
    </Grid.ColumnDefinitions>
    
    <!-- å®šä¹‰è¡Œ -->
    <Grid.RowDefinitions>
        <RowDefinition Height="50" />
        <RowDefinition Height="*" />
        <RowDefinition Height="30" />
    </Grid.RowDefinitions>
    
    <!-- æ”¾ç½®æ§ä»¶ -->
    <TextBlock Grid.Column="0" Grid.Row="0" Text="æ ‡ç­¾" />
    <TextBox Grid.Column="1" Grid.Row="0" Grid.ColumnSpan="2" Text="è¾“å…¥æ¡†" />
    <ListBox Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" ItemsSource="{Binding Items}" />
    <Button Grid.Column="0" Grid.Row="2" Content="ç¡®å®š" />
    <Button Grid.Column="2" Grid.Row="2" Content="å–æ¶ˆ" />
</Grid>
```

#### 3.2.2 StackPanel å¸ƒå±€è¯¦è§£

StackPanel ç”¨äºç®€å•çš„çº¿æ€§æ’åˆ—ï¼š

```xaml
<!-- å‚ç›´æ’åˆ— -->
<StackPanel Orientation="Vertical" Margin="10">
    <TextBlock Text="ä¸ªäººä¿¡æ¯" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />
    <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
        <TextBlock Text="å§“å:" Width="80" />
        <TextBox Width="200" />
    </StackPanel>
    <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
        <TextBlock Text="å¹´é¾„:" Width="80" />
        <TextBox Width="200" />
    </StackPanel>
    <StackPanel Orientation="Horizontal" Margin="0,10,0,0" HorizontalAlignment="Right">
        <Button Content="ä¿å­˜" Margin="0,0,10,0" />
        <Button Content="å–æ¶ˆ" />
    </StackPanel>
</StackPanel>
```

#### 3.2.3 DockPanel å¸ƒå±€è¯¦è§£

DockPanel ç”¨äºå…ƒç´ åœé ï¼š

```xaml
<DockPanel LastChildFill="True">
    <!-- åœé åœ¨é¡¶éƒ¨ -->
    <Menu DockPanel.Dock="Top">
        <MenuItem Header="æ–‡ä»¶">
            <MenuItem Header="æ–°å»º" />
            <MenuItem Header="æ‰“å¼€" />
            <MenuItem Header="ä¿å­˜" />
        </MenuItem>
        <MenuItem Header="ç¼–è¾‘">
            <MenuItem Header="å¤åˆ¶" />
            <MenuItem Header="ç²˜è´´" />
        </MenuItem>
    </Menu>
    
    <!-- åœé åœ¨å·¦ä¾§ -->
    <StackPanel DockPanel.Dock="Left" Width="200" Background="LightGray">
        <TextBlock Text="å¯¼èˆªèœå•" Margin="10" FontWeight="Bold" />
        <Button Content="é¦–é¡µ" Margin="10" />
        <Button Content="è®¾ç½®" Margin="10" />
        <Button Content="å¸®åŠ©" Margin="10" />
    </StackPanel>
    
    <!-- åœé åœ¨åº•éƒ¨ -->
    <StatusBar DockPanel.Dock="Bottom">
        <TextBlock>çŠ¶æ€æ ä¿¡æ¯</TextBlock>
    </StatusBar>
    
    <!-- å¡«å……å‰©ä½™ç©ºé—´ -->
    <Grid Background="White">
        <TextBlock Text="ä¸»å†…å®¹åŒºåŸŸ" HorizontalAlignment="Center" VerticalAlignment="Center" />
    </Grid>
</DockPanel>
```

### 3.3 æ•°æ®ç»‘å®šé«˜çº§ç‰¹æ€§

#### 3.3.1 æ•°æ®ä¸Šä¸‹æ–‡ï¼ˆDataContextï¼‰

DataContext æ˜¯ WPF æ•°æ®ç»‘å®šçš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºæŒ‡å®šæ•°æ®ç»‘å®šçš„æºï¼š

```csharp
// è®¾ç½®æ•°æ®ä¸Šä¸‹æ–‡
public MainWindow()
{
    InitializeComponent();
    
    // è®¾ç½®æ•´ä¸ªçª—å£çš„æ•°æ®ä¸Šä¸‹æ–‡
    DataContext = new ViewModel();
}

// è§†å›¾æ¨¡å‹ç±»
public class ViewModel
{
    public string Name { get; set; } = "WPF ç¤ºä¾‹";
    public int Count { get; set; } = 42;
    public ObservableCollection<string> Items { get; set; }
    
    public ViewModel()
    {
        Items = new ObservableCollection<string>
        {
            "é¡¹ç›® 1",
            "é¡¹ç›® 2",
            "é¡¹ç›® 3"
        };
    }
}
```

```xaml
<!-- ä½¿ç”¨æ•°æ®ä¸Šä¸‹æ–‡ -->
<Grid>
    <TextBlock Text="{Binding Name}" />
    <TextBlock Text="{Binding Count}" />
    <ListBox ItemsSource="{Binding Items}" />
</Grid>
```

#### 3.3.2 å‘½ä»¤ç»‘å®š

WPF çš„å‘½ä»¤ç³»ç»Ÿå…è®¸å°†ç”¨æˆ·æ“ä½œä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼š

```csharp
// å®ç° ICommand æ¥å£
public class RelayCommand : ICommand
{
    private readonly Action<object> _execute;
    private readonly Func<object, bool> _canExecute;
    
    public event EventHandler CanExecuteChanged;
    
    public RelayCommand(Action<object> execute, Func<object, bool> canExecute = null)
    {
        _execute = execute;
        _canExecute = canExecute;
    }
    
    public bool CanExecute(object parameter)
    {
        return _canExecute == null || _canExecute(parameter);
    }
    
    public void Execute(object parameter)
    {
        _execute(parameter);
    }
    
    public void RaiseCanExecuteChanged()
    {
        CanExecuteChanged?.Invoke(this, EventArgs.Empty);
    }
}

// åœ¨è§†å›¾æ¨¡å‹ä¸­ä½¿ç”¨å‘½ä»¤
public class ViewModel
{
    public ICommand ClickCommand { get; set; }
    public ICommand DeleteCommand { get; set; }
    
    public ViewModel()
    {
        ClickCommand = new RelayCommand(ExecuteClick);
        DeleteCommand = new RelayCommand(ExecuteDelete, CanDelete);
    }
    
    private void ExecuteClick(object parameter)
    {
        // æ‰§è¡Œç‚¹å‡»æ“ä½œ
    }
    
    private void ExecuteDelete(object parameter)
    {
        // æ‰§è¡Œåˆ é™¤æ“ä½œ
    }
    
    private bool CanDelete(object parameter)
    {
        // åˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ é™¤
        return true;
    }
}
```

```xaml
<!-- ä½¿ç”¨å‘½ä»¤ -->
<Button Content="ç‚¹å‡»" Command="{Binding ClickCommand}" />
<Button Content="åˆ é™¤" Command="{Binding DeleteCommand}" CommandParameter="{Binding SelectedItem}" />
```

#### 3.3.3 æ•°æ®æ¨¡æ¿

æ•°æ®æ¨¡æ¿ç”¨äºå®šä¹‰æ•°æ®å¯¹è±¡çš„å¯è§†åŒ–è¡¨ç¤ºï¼š

```xaml
<!-- å®šä¹‰æ•°æ®æ¨¡æ¿ -->
<DataTemplate x:Key="ItemTemplate">
    <StackPanel Orientation="Horizontal">
        <Ellipse Width="10" Height="10" Fill="{Binding Color}" Margin="0,0,10,0" />
        <TextBlock Text="{Binding Name}" />
        <TextBlock Text="{Binding Value}" Margin="10,0,0,0" />
    </StackPanel>
</DataTemplate>

<!-- ä½¿ç”¨æ•°æ®æ¨¡æ¿ -->
<ListBox ItemsSource="{Binding Items}" ItemTemplate="{StaticResource ItemTemplate}" />
```

```csharp
// æ•°æ®æ¨¡å‹
public class Item
{
    public string Name { get; set; }
    public int Value { get; set; }
    public string Color { get; set; }
}

// è§†å›¾æ¨¡å‹
public class ViewModel
{
    public ObservableCollection<Item> Items { get; set; }
    
    public ViewModel()
    {
        Items = new ObservableCollection<Item>
        {
            new Item { Name = "é¡¹ç›® 1", Value = 10, Color = "Red" },
            new Item { Name = "é¡¹ç›® 2", Value = 20, Color = "Green" },
            new Item { Name = "é¡¹ç›® 3", Value = 30, Color = "Blue" }
        };
    }
}
```

## 4. WPF é«˜çº§ç‰¹æ€§

### 4.1 èµ„æºç³»ç»Ÿ

WPF çš„èµ„æºç³»ç»Ÿå…è®¸åœ¨åº”ç”¨ç¨‹åºä¸­å…±äº«å’Œé‡ç”¨å¯¹è±¡ï¼š

#### 4.1.1 èµ„æºå®šä¹‰ä¸ä½¿ç”¨

```xaml
<!-- å®šä¹‰èµ„æº -->
<Window.Resources>
    <SolidColorBrush x:Key="ButtonBackground" Color="Blue" />
    <FontFamily x:Key="DefaultFont">Arial</FontFamily>
    <Style x:Key="HeaderStyle" TargetType="TextBlock">
        <Setter Property="FontSize" Value="18" />
        <Setter Property="FontWeight" Value="Bold" />
        <Setter Property="Margin" Value="0,0,0,10" />
    </Style>
</Window.Resources>

<!-- ä½¿ç”¨èµ„æº -->
<Button Background="{StaticResource ButtonBackground}" FontFamily="{StaticResource DefaultFont}" />
<TextBlock Text="æ ‡é¢˜" Style="{StaticResource HeaderStyle}" />
```

#### 4.1.2 èµ„æºä½œç”¨åŸŸ

WPF èµ„æºå¯ä»¥åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­å®šä¹‰ï¼š

- **åº”ç”¨ç¨‹åºçº§åˆ«**ï¼šåœ¨ App.xaml ä¸­å®šä¹‰ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºå¯ç”¨
- **çª—å£çº§åˆ«**ï¼šåœ¨ Window ä¸­å®šä¹‰ï¼Œå½“å‰çª—å£å¯ç”¨
- **æ§ä»¶çº§åˆ«**ï¼šåœ¨æ§ä»¶ä¸­å®šä¹‰ï¼Œå½“å‰æ§ä»¶åŠå…¶å­æ§ä»¶å¯ç”¨

### 4.2 æ ·å¼ä¸ä¸»é¢˜

#### 4.2.1 æ ·å¼ç»§æ‰¿

```xaml
<!-- åŸºç¡€æ ·å¼ -->
<Style x:Key="BaseButtonStyle" TargetType="Button">
    <Setter Property="FontSize" Value="14" />
    <Setter Property="Padding" Value="10,5" />
</Style>

<!-- ç»§æ‰¿æ ·å¼ -->
<Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
    <Setter Property="Background" Value="Blue" />
    <Setter Property="Foreground" Value="White" />
</Style>

<Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
    <Setter Property="Background" Value="Gray" />
    <Setter Property="Foreground" Value="Black" />
</Style>
```

#### 4.2.2 è§¦å‘å™¨

è§¦å‘å™¨ç”¨äºå“åº”å±æ€§å˜åŒ–ï¼š

```xaml
<Style x:Key="HoverButtonStyle" TargetType="Button">
    <Setter Property="Background" Value="Blue" />
    <Setter Property="Foreground" Value="White" />
    <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
            <Setter Property="Background" Value="LightBlue" />
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
            <Setter Property="Background" Value="DarkBlue" />
        </Trigger>
        <Trigger Property="IsEnabled" Value="False">
            <Setter Property="Background" Value="Gray" />
            <Setter Property="Foreground" Value="LightGray" />
        </Trigger>
    </Style.Triggers>
</Style>
```

### 4.3 åŠ¨ç”»ä¸æ•ˆæœ

WPF æä¾›äº†å¼ºå¤§çš„åŠ¨ç”»å’Œè§†è§‰æ•ˆæœç³»ç»Ÿï¼š

#### 4.3.1 åŸºæœ¬åŠ¨ç”»

```xaml
<!-- å®šä¹‰åŠ¨ç”» -->
<Window.Resources>
    <Storyboard x:Key="FadeInAnimation">
        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                         From="0" To="1"
                         Duration="0:0:1" />
    </Storyboard>
    
    <Storyboard x:Key="SlideAnimation">
        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)"
                         From="-100" To="0"
                         Duration="0:0:0.5" />
    </Storyboard>
</Window.Resources>

<!-- ä½¿ç”¨åŠ¨ç”» -->
<Button Content="åŠ¨ç”»æŒ‰é’®" Opacity="0">
    <Button.RenderTransform>
        <TranslateTransform X="-100" />
    </Button.RenderTransform>
    <Button.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}" />
            <BeginStoryboard Storyboard="{StaticResource SlideAnimation}" />
        </EventTrigger>
    </Button.Triggers>
</Button>
```

#### 4.3.2 è§†è§‰æ•ˆæœ

```xaml
<!-- é˜´å½±æ•ˆæœ -->
<Button Content="é˜´å½±æŒ‰é’®">
    <Button.Effect>
        <DropShadowEffect Color="Black" Direction="270" ShadowDepth="5" BlurRadius="10" />
    </Button.Effect>
</Button>

<!-- æ¨¡ç³Šæ•ˆæœ -->
<TextBlock Text="æ¨¡ç³Šæ–‡æœ¬">
    <TextBlock.Effect>
        <BlurEffect Radius="3" />
    </TextBlock.Effect>
</TextBlock>
```

### 4.4 è‡ªå®šä¹‰æ§ä»¶

WPF å…è®¸åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶ï¼Œæ‰©å±•ç°æœ‰æ§ä»¶çš„åŠŸèƒ½ï¼š

#### 4.4.1 è‡ªå®šä¹‰æ§ä»¶ç¤ºä¾‹

```csharp
// è‡ªå®šä¹‰æŒ‰é’®æ§ä»¶
public class CustomButton : Button
{
    static CustomButton()
    {
        DefaultStyleKeyProperty.OverrideMetadata(typeof(CustomButton),
            new FrameworkPropertyMetadata(typeof(CustomButton)));
    }
    
    // ä¾èµ–å±æ€§
    public static readonly DependencyProperty IconProperty = 
        DependencyProperty.Register("Icon", typeof(string), typeof(CustomButton), new PropertyMetadata(null));
    
    public string Icon
    {
        get { return (string)GetValue(IconProperty); }
        set { SetValue(IconProperty, value); }
    }
}
```

```xaml
<!-- è‡ªå®šä¹‰æ§ä»¶æ¨¡æ¿ -->
<Style TargetType="local:CustomButton">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="local:CustomButton">
                <Border Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="5">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="{TemplateBinding Icon}" Margin="0,0,5,0" />
                        <ContentPresenter />
                    </StackPanel>
                </Border>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>

<!-- ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶ -->
<local:CustomButton Content="å¸¦æœ‰å›¾æ ‡çš„æŒ‰é’®" Icon="ğŸ”" />
```

## 5. WPF åº”ç”¨ç¨‹åºæ¶æ„

### 5.1 MVVM æ¨¡å¼

MVVMï¼ˆModel-View-ViewModelï¼‰æ˜¯ WPF åº”ç”¨ç¨‹åºçš„æ¨èæ¶æ„æ¨¡å¼ï¼š

- **Model**ï¼šæ•°æ®æ¨¡å‹ï¼ŒåŒ…å«ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®
- **View**ï¼šè§†å›¾ï¼Œç”¨æˆ·ç•Œé¢ï¼Œç”± XAML å®šä¹‰
- **ViewModel**ï¼šè§†å›¾æ¨¡å‹ï¼Œè¿æ¥ Model å’Œ Viewï¼ŒåŒ…å« UI é€»è¾‘

#### 5.1.1 MVVM æ¶æ„ç¤ºä¾‹

```csharp
// Model
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Email { get; set; }
}

// ViewModel
public class UserViewModel : INotifyPropertyChanged
{
    private User _user;
    public User User
    {
        get { return _user; }
        set
        {
            _user = value;
            OnPropertyChanged(nameof(User));
        }
    }
    
    public string Name
    {
        get { return _user?.Name; }
        set
        {
            if (_user != null && _user.Name != value)
            {
                _user.Name = value;
                OnPropertyChanged(nameof(Name));
            }
        }
    }
    
    public string Email
    {
        get { return _user?.Email; }
        set
        {
            if (_user != null && _user.Email != value)
            {
                _user.Email = value;
                OnPropertyChanged(nameof(Email));
            }
        }
    }
    
    public ICommand SaveCommand { get; set; }
    
    public UserViewModel()
    {
        User = new User();
        SaveCommand = new RelayCommand(Save);
    }
    
    private void Save(object parameter)
    {
        // ä¿å­˜ç”¨æˆ·æ•°æ®
    }
    
    public event PropertyChangedEventHandler PropertyChanged;
    
    protected virtual void OnPropertyChanged(string propertyName)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }
}
```

```xaml
<!-- View -->
<Window x:Class="MyWpfApp.UserView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ç”¨æˆ·ç¼–è¾‘" Height="300" Width="400">
    <Grid>
        <StackPanel Margin="20">
            <TextBlock Text="ç”¨æˆ·å:" />
            <TextBox Text="{Binding Name, Mode=TwoWay}" Margin="0,5,0,10" />
            <TextBlock Text="é‚®ç®±:" />
            <TextBox Text="{Binding Email, Mode=TwoWay}" Margin="0,5,0,10" />
            <Button Content="ä¿å­˜" Command="{Binding SaveCommand}" Width="100" />
        </StackPanel>
    </Grid>
</Window>
```

```csharp
// ä»£ç -behind
public partial class UserView : Window
{
    public UserView()
    {
        InitializeComponent();
        DataContext = new UserViewModel();
    }
}
```

### 5.2 ä¾èµ–æ³¨å…¥

ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå®ç°æ§åˆ¶åè½¬ï¼Œæé«˜ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š

#### 5.2.1 ä¾èµ–æ³¨å…¥ç¤ºä¾‹

```csharp
// æœåŠ¡æ¥å£
public interface IUserService
{
    User GetUser(int id);
    void SaveUser(User user);
}

// æœåŠ¡å®ç°
public class UserService : IUserService
{
    public User GetUser(int id)
    {
        // ä»æ•°æ®åº“è·å–ç”¨æˆ·
        return new User { Id = id, Name = "æµ‹è¯•ç”¨æˆ·", Email = "test@example.com" };
    }
    
    public void SaveUser(User user)
    {
        // ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“
    }
}

// è§†å›¾æ¨¡å‹
public class UserViewModel
{
    private readonly IUserService _userService;
    
    public User User { get; set; }
    public ICommand LoadCommand { get; set; }
    public ICommand SaveCommand { get; set; }
    
    public UserViewModel(IUserService userService)
    {
        _userService = userService;
        LoadCommand = new RelayCommand(LoadUser);
        SaveCommand = new RelayCommand(SaveUser);
    }
    
    private void LoadUser(object parameter)
    {
        User = _userService.GetUser(1);
    }
    
    private void SaveUser(object parameter)
    {
        _userService.SaveUser(User);
    }
}
```

#### 5.2.2 ä½¿ç”¨ä¾èµ–æ³¨å…¥å®¹å™¨

```csharp
// åœ¨ App.xaml.cs ä¸­é…ç½®ä¾èµ–æ³¨å…¥
public partial class App : Application
{
    private ServiceProvider _serviceProvider;
    
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);
        
        // é…ç½®æœåŠ¡
        var services = new ServiceCollection();
        services.AddSingleton<IUserService, UserService>();
        services.AddTransient<UserViewModel>();
        services.AddTransient<UserView>();
        
        _serviceProvider = services.BuildServiceProvider();
        
        // å¯åŠ¨åº”ç”¨
        var mainWindow = _serviceProvider.GetRequiredService<UserView>();
        mainWindow.Show();
    }
}
```

### 5.3 æ¨¡å—åŒ–åº”ç”¨

å¯¹äºå¤§å‹åº”ç”¨ç¨‹åºï¼Œæ¨¡å—åŒ–è®¾è®¡å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼š

#### 5.3.1 æ¨¡å—åŒ–æ¶æ„

- **æ¨¡å—å®šä¹‰**ï¼šæ¯ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½å•å…ƒ
- **æ¨¡å—åŠ è½½**ï¼šåŠ¨æ€åŠ è½½å’Œå¸è½½æ¨¡å—
- **æ¨¡å—é€šä¿¡**ï¼šæ¨¡å—é—´é€šè¿‡äº‹ä»¶ã€æœåŠ¡ç­‰æ–¹å¼é€šä¿¡

#### 5.3.2 æ¨¡å—åŒ–ç¤ºä¾‹

```csharp
// æ¨¡å—æ¥å£
public interface IModule
{
    string Name { get; }
    void Initialize();
    void Shutdown();
}

// æ¨¡å—å®ç°
public class UserModule : IModule
{
    public string Name => "ç”¨æˆ·æ¨¡å—";
    
    public void Initialize()
    {
        // åˆå§‹åŒ–æ¨¡å—
        Console.WriteLine($"{Name} å·²åˆå§‹åŒ–");
    }
    
    public void Shutdown()
    {
        // å…³é—­æ¨¡å—
        Console.WriteLine($"{Name} å·²å…³é—­");
    }
}

// æ¨¡å—ç®¡ç†å™¨
public class ModuleManager
{
    private readonly List<IModule> _modules = new List<IModule>();
    
    public void LoadModule(IModule module)
    {
        module.Initialize();
        _modules.Add(module);
    }
    
    public void UnloadModule(IModule module)
    {
        if (_modules.Contains(module))
        {
            module.Shutdown();
            _modules.Remove(module);
        }
    }
    
    public void LoadAllModules()
    {
        // åŠ è½½æ‰€æœ‰æ¨¡å—
        LoadModule(new UserModule());
        // åŠ è½½å…¶ä»–æ¨¡å—...
    }
}
```

## 6. WPF æ€§èƒ½ä¼˜åŒ–

### 6.1 æ€§èƒ½ä¼˜åŒ–åŸåˆ™

- **å‡å°‘è§†è§‰æ ‘å¤æ‚åº¦**ï¼šç®€åŒ– UI å±‚æ¬¡ç»“æ„
- **ä½¿ç”¨è™šæ‹ŸåŒ–**ï¼šå¯¹äºå¤§é‡æ•°æ®ï¼Œä½¿ç”¨è™šæ‹ŸåŒ–æ§ä»¶
- **ä¼˜åŒ–æ•°æ®ç»‘å®š**ï¼šé¿å…ä¸å¿…è¦çš„ç»‘å®šå’Œæ›´æ–°
- **ä½¿ç”¨å¼‚æ­¥æ“ä½œ**ï¼šå¯¹äºè€—æ—¶æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥å¤„ç†
- **åˆç†ä½¿ç”¨èµ„æº**ï¼šé¿å…å†…å­˜æ³„æ¼å’Œèµ„æºæµªè´¹

### 6.2 å¸¸è§æ€§èƒ½é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 6.2.1 åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–

å¯¹äºå¤§é‡æ•°æ®çš„åˆ—è¡¨ï¼Œä½¿ç”¨è™šæ‹ŸåŒ–ï¼š

```xaml
<!-- ä½¿ç”¨è™šæ‹ŸåŒ– -->
<ListBox ItemsSource="{Binding Items}"
         VirtualizingStackPanel.IsVirtualizing="True"
         VirtualizingStackPanel.VirtualizationMode="Recycling" />

<!-- å¯¹äº DataGrid -->
<DataGrid ItemsSource="{Binding Items}"
          EnableRowVirtualization="True"
          EnableColumnVirtualization="True" />
```

#### 6.2.2 æ•°æ®ç»‘å®šä¼˜åŒ–

- **ä½¿ç”¨ ObservableCollection**ï¼šå¯¹äºåŠ¨æ€æ•°æ®ï¼Œä½¿ç”¨ ObservableCollection è€Œä¸æ˜¯ List
- **é¿å…ä¸å¿…è¦çš„ç»‘å®š**ï¼šåªç»‘å®šéœ€è¦çš„å±æ€§
- **ä½¿ç”¨ BindingMode.OneWay**ï¼šå¯¹äºä¸éœ€è¦åŒå‘ç»‘å®šçš„åœºæ™¯
- **ä½¿ç”¨ UpdateSourceTrigger.PropertyChanged**ï¼šæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„æ›´æ–°è§¦å‘æ–¹å¼

#### 6.2.3 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

- **ä½¿ç”¨ DrawingVisual**ï¼šå¯¹äºå¤§é‡å›¾å½¢å…ƒç´ ï¼Œä½¿ç”¨ DrawingVisual
- **é¿å…è¿‡åº¦ä½¿ç”¨é€æ˜åº¦**ï¼šé€æ˜åº¦ä¼šå¢åŠ æ¸²æŸ“å¼€é”€
- **åˆç†ä½¿ç”¨ç¼“å­˜**ï¼šå¯¹äºå¤æ‚çš„ UI å…ƒç´ ï¼Œä½¿ç”¨ç¼“å­˜

```xaml
<!-- ä½¿ç”¨ç¼“å­˜ -->
<Border CacheMode="BitmapCache">
    <!-- å¤æ‚çš„ UI å…ƒç´  -->
</Border>
```

### 6.3 æ€§èƒ½åˆ†æå·¥å…·

- **Visual Studio æ€§èƒ½åˆ†æå™¨**ï¼šåˆ†æ CPU å’Œå†…å­˜ä½¿ç”¨
- **WPF æ€§èƒ½å·¥å…·**ï¼šåˆ†æè§†è§‰æ ‘å’Œæ¸²æŸ“æ€§èƒ½
- **Snoop**ï¼šè°ƒè¯• WPF åº”ç”¨ç¨‹åºçš„ UI
- **WPFLyzer**ï¼šåˆ†æ WPF åº”ç”¨ç¨‹åºçš„æ€§èƒ½

## 7. WPF åº”ç”¨ç¨‹åºéƒ¨ç½²

### 7.1 éƒ¨ç½²æ–¹å¼

#### 7.1.1 ä¼ ç»Ÿéƒ¨ç½²

- **ClickOnce éƒ¨ç½²**ï¼šé€šè¿‡ Web æˆ–ç½‘ç»œå…±äº«éƒ¨ç½²
- **Windows Installer**ï¼šåˆ›å»º MSI å®‰è£…åŒ…
- **XCopy éƒ¨ç½²**ï¼šç›´æ¥å¤åˆ¶æ–‡ä»¶

#### 7.1.2 ç°ä»£éƒ¨ç½²

- **MSIX æ‰“åŒ…**ï¼šç°ä»£ Windows åº”ç”¨æ‰“åŒ…æ ¼å¼
- **.NET Core è‡ªåŒ…å«éƒ¨ç½²**ï¼šåŒ…å«è¿è¡Œæ—¶ï¼Œæ— éœ€å®‰è£… .NET
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨ Docker å®¹å™¨

### 7.2 éƒ¨ç½²é…ç½®

#### 7.2.1 åº”ç”¨ç¨‹åºé…ç½®

```xml
<!-- App.config é…ç½® -->
<configuration>
    <appSettings>
        <add key="ApiUrl" value="https://api.example.com" />
        <add key="Timeout" value="30" />
    </appSettings>
    <connectionStrings>
        <add name="DefaultConnection" connectionString="Data Source=.;Initial Catalog=MyDatabase;Integrated Security=True" />
    </connectionStrings>
</configuration>
```

#### 7.2.2 åº”ç”¨ç¨‹åºæ¸…å•

```xml
<!-- åº”ç”¨ç¨‹åºæ¸…å• -->
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity version="1.0.0.0" name="MyWpfApp.app" />
    <trustInfo xmlns="urn:schemas-microsoft-com:asm.v2">
        <security>
            <requestedPrivileges xmlns="urn:schemas-microsoft-com:asm.v3">
                <requestedExecutionLevel level="asInvoker" uiAccess="false" />
            </requestedPrivileges>
        </security>
    </trustInfo>
    <compatibility xmlns="urn:schemas-microsoft-com:compatibility.v1">
        <application>
            <supportedOS Id="{e2011457-1546-43c5-a5fe-008deee3d3f0}" />
            <supportedOS Id="{35138b9a-5d96-4fbd-8e2d-a2440225f93a}" />
            <supportedOS Id="{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}" />
            <supportedOS Id="{1f676c76-80e1-4239-95bb-83d0f6d0da78}" />
        </application>
    </compatibility>
</assembly>
```

### 7.3 åº”ç”¨ç¨‹åºæ›´æ–°

#### 7.3.1 ClickOnce æ›´æ–°

ClickOnce æä¾›äº†è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼š

1. åœ¨é¡¹ç›®å±æ€§ä¸­é…ç½®æ›´æ–°è®¾ç½®
2. å‘å¸ƒæ–°ç‰ˆæœ¬åˆ°æœåŠ¡å™¨
3. åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä¼šæ£€æŸ¥å¹¶ä¸‹è½½æ›´æ–°

#### 7.3.2 è‡ªå®šä¹‰æ›´æ–°æœºåˆ¶

```csharp
// ç®€å•çš„æ›´æ–°æ£€æŸ¥
public async Task CheckForUpdates()
{
    try
    {
        using (var client = new HttpClient())
        {
            var response = await client.GetStringAsync("https://api.example.com/version");
            var latestVersion = Version.Parse(response);
            var currentVersion = Assembly.GetExecutingAssembly().GetName().Version;
            
            if (latestVersion > currentVersion)
            {
                // æç¤ºç”¨æˆ·æ›´æ–°
                var result = MessageBox.Show("å‘ç°æ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦æ›´æ–°ï¼Ÿ", "æ›´æ–°æç¤º", MessageBoxButton.YesNo);
                if (result == MessageBoxResult.Yes)
                {
                    // ä¸‹è½½å¹¶å®‰è£…æ›´æ–°
                    await DownloadAndInstallUpdate();
                }
            }
        }
    }
    catch (Exception ex)
    {
        // å¤„ç†å¼‚å¸¸
    }
}
```

## 8. WPF æœ€ä½³å®è·µ

### 8.1 ä»£ç ç»„ç»‡

- **éµå¾ª MVVM æ¨¡å¼**ï¼šåˆ†ç¦» UI å’Œä¸šåŠ¡é€»è¾‘
- **ä½¿ç”¨ä¾èµ–æ³¨å…¥**ï¼šæé«˜ä»£ç çš„å¯æµ‹è¯•æ€§
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå°†åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºç‹¬ç«‹çš„æ¨¡å—
- **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨ä¸€è‡´çš„å‘½åè§„èŒƒ
- **ä»£ç æ³¨é‡Š**ï¼šæ·»åŠ å¿…è¦çš„æ³¨é‡Š

### 8.2 UI è®¾è®¡

- **éµå¾ª Windows è®¾è®¡æŒ‡å—**ï¼šä½¿ç”¨ç°ä»£ Windows è®¾è®¡é£æ ¼
- **å“åº”å¼è®¾è®¡**ï¼šé€‚åº”ä¸åŒçš„çª—å£å¤§å°
- ** accessibility**ï¼šç¡®ä¿åº”ç”¨ç¨‹åºå¯¹æ‰€æœ‰äººå¯ç”¨
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„ UI å…ƒç´ å’Œæ¸²æŸ“

### 8.3 æ•°æ®å¤„ç†

- **ä½¿ç”¨å¼‚æ­¥æ“ä½œ**ï¼šé¿å…é˜»å¡ UI çº¿ç¨‹
- **åˆç†ä½¿ç”¨ç¼“å­˜**ï¼šå‡å°‘é‡å¤è®¡ç®—å’Œç½‘ç»œè¯·æ±‚
- **é”™è¯¯å¤„ç†**ï¼šå¦¥å–„å¤„ç†å¼‚å¸¸
- **æ•°æ®éªŒè¯**ï¼šç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§

### 8.4 æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•ä¸šåŠ¡é€»è¾‘
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- **UI æµ‹è¯•**ï¼šæµ‹è¯•ç”¨æˆ·ç•Œé¢
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šå‡å°‘æ‰‹åŠ¨æµ‹è¯•çš„å·¥ä½œé‡

## 9. æ€»ç»“

WPF æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç”¨æˆ·ç•Œé¢æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œçµæ´»çš„æ¶æ„ï¼Œé€‚åˆæ„å»ºç°ä»£åŒ–çš„ Windows æ¡Œé¢åº”ç”¨ç¨‹åºã€‚é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œæ‚¨åº”è¯¥å·²ç»æŒæ¡äº† WPF çš„åŸºæœ¬æ¦‚å¿µã€XAML è¯­æ³•ã€å¸ƒå±€ç³»ç»Ÿã€æ•°æ®ç»‘å®šã€æ ·å¼ä¸æ¨¡æ¿ã€é«˜çº§ç‰¹æ€§ã€åº”ç”¨ç¨‹åºæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–å’Œéƒ¨ç½²ç­‰æ–¹é¢çš„çŸ¥è¯†ã€‚

WPF çš„å­¦ä¹ æ›²çº¿å¯èƒ½ç›¸å¯¹é™¡å³­ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œæ‚¨å°†èƒ½å¤Ÿåˆ›å»ºå‡ºç¾è§‚ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„æ¡Œé¢åº”ç”¨ç¨‹åºã€‚éšç€ .NET çš„ä¸æ–­å‘å±•ï¼ŒWPF ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¤šçš„åŠŸèƒ½å’Œæ›´å¥½çš„æ€§èƒ½ã€‚

å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©æ‚¨å¿«é€Ÿå…¥é—¨ WPF å¼€å‘ï¼Œå¹¶åœ¨å®è·µä¸­ä¸æ–­æå‡è‡ªå·±çš„æŠ€èƒ½ã€‚ç¥æ‚¨å¼€å‘æ„‰å¿«ï¼

## å‚è€ƒèµ„æ–™

- [Microsoft WPF æ–‡æ¡£](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/)
- [WPF æ•™ç¨‹](https://wpf-tutorial.com/)
- [MVVM æ¨¡å¼](https://docs.microsoft.com/en-us/archive/msdn-magazine/2009/february/patterns-wpf-apps-with-the-model-view-viewmodel-design-pattern)
- [WPF æ€§èƒ½ä¼˜åŒ–](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/advanced/optimizing-wpf-application-performance)
- [WPF éƒ¨ç½²](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/app-development/deploying-a-wpf-application)
